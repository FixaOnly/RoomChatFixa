<!DOCTYPE html>
<html lang="en" class="bg-black text-white">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>FIXA Chatroom</title>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Poppins', sans-serif;
    }
    .admin-name {
      color: #ff4d4d;
      font-weight: bold;
      text-shadow: 0 0 5px #ff4d4d;
    }
    .message-box {
      transition: all 0.3s ease;
    }
    .message-box:hover {
      transform: scale(1.02);
    }
    .bubble-left {
      background-color: #1f2937;
      border-radius: 10px 10px 10px 0;
      align-self: flex-start;
    }
    .bubble-right {
      background-color: #b91c1c;
      border-radius: 10px 10px 0 10px;
      align-self: flex-end;
    }
    .badge-admin {
      background: #ff4d4d;
      color: white;
      font-size: 0.6rem;
      padding: 2px 6px;
      border-radius: 4px;
      margin-left: 6px;
      text-shadow: 0 0 3px black;
    }
  </style>
</head>
<body class="bg-black text-white min-h-screen flex flex-col items-center justify-start p-4">
  <div id="chatApp" class="w-full max-w-md">
    <div id="namePrompt" class="mb-4">
      <input id="usernameInput" type="text" placeholder="Masukkan Nama" class="w-full p-2 rounded bg-gray-900 text-white">
      <button onclick="saveName()" class="mt-2 w-full p-2 bg-red-600 rounded hover:bg-red-700 transition">Masuk</button>
    </div>

    <div id="chatSection" class="hidden">
      <div class="mb-2 text-center text-2xl font-bold text-red-500">üí¨ FixaXiterz Chat</div>
      <div id="messages" class="h-96 overflow-y-auto space-y-2 p-2 mb-2 rounded bg-gray-900 flex flex-col"></div>
      <div class="flex space-x-2">
        <input id="messageInput" type="text" placeholder="Ketik pesan..." class="flex-1 p-2 rounded bg-gray-800 text-white focus:outline-none focus:ring-2 focus:ring-red-500">
        <button onclick="sendMessage()" class="bg-red-600 px-4 rounded hover:bg-red-700 transition">Kirim</button>
      </div>
    </div>
  </div>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyAk-K4OpybUDsFfGBdTl2h12nIBI_8mab4",
      authDomain: "fixaxiterzweb.firebaseapp.com",
      databaseURL: "https://fixaxiterzweb-default-rtdb.firebaseio.com",
      projectId: "fixaxiterzweb",
      storageBucket: "fixaxiterzweb.firebasestorage.app",
      messagingSenderId: "724545824906",
      appId: "1:724545824906:web:e3058b5697062e0ceee573",
      measurementId: "G-1P6VVHGPT0"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    let username = localStorage.getItem("fixa_username");
    let isAdmin = false;

    function saveName() {
      const input = document.getElementById("usernameInput").value.trim();
      if (!input) return;

      if (input === "FIXAXITERZROOMCHATVIP") {
        username = "FixaXiterz-ADMIN";
        isAdmin = true;
      } else {
        if (localStorage.getItem("fixa_username")) return alert("Nama sudah dibuat dan tidak bisa diubah.");
        username = input;
      }

      localStorage.setItem("fixa_username", username);
      document.getElementById("namePrompt").classList.add("hidden");
      document.getElementById("chatSection").classList.remove("hidden");
      listenMessages();
    }

    if (username) {
      if (username === "FixaXiterz-ADMIN") isAdmin = true;
      document.getElementById("namePrompt").classList.add("hidden");
      document.getElementById("chatSection").classList.remove("hidden");
      listenMessages();
    }

    function sendMessage() {
      const input = document.getElementById("messageInput");
      const text = input.value.trim();
      if (!text) return;
      const now = new Date();
      const time = now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
      db.ref("chat").push({ name: username, text, time });
      input.value = "";
    }

    function listenMessages() {
      db.ref("chat").on("value", snap => {
        const messagesDiv = document.getElementById("messages");
        messagesDiv.innerHTML = "";
        snap.forEach(data => {
          const { name, text, time } = data.val();
          const div = document.createElement("div");
          const isMsgAdmin = name === "FixaXiterz-ADMIN";
          const isMyMessage = name === username;
          div.className = `message-box p-2 max-w-[85%] ${isMyMessage ? 'bubble-right self-end' : 'bubble-left self-start'}`;

          div.innerHTML = `
            <div class="text-sm mb-1">
              <strong class="${isMsgAdmin ? 'admin-name' : ''}">${name}</strong>
              ${isMsgAdmin ? '<span class="badge-admin">ADMIN</span>' : ''}
            </div>
            <div class="text-base">${text}</div>
            <div class="text-xs text-gray-400 text-right mt-1">${time}</div>
            ${isAdmin ? `
              <div class="flex justify-end space-x-2 mt-1 text-xs">
                <button onclick="deleteMsg('${data.key}')" class="text-red-400">Hapus</button>
                <button onclick="blockUser('${name}')" class="text-yellow-400">Blok</button>
              </div>` : ''}
          `;
          messagesDiv.appendChild(div);
          messagesDiv.scrollTop = messagesDiv.scrollHeight;
        });
      });
    }

    function deleteMsg(key) {
      if (confirm("Hapus pesan ini?")) {
        db.ref("chat/" + key).remove();
      }
    }

    function blockUser(nama) {
      const durasi = prompt("Blokir berapa jam? (1 / 3 / 999 untuk permanen)");
      if (!durasi) return;
      const until = Date.now() + parseInt(durasi) * 60 * 60 * 1000;
      db.ref("blocked/" + nama).set(until);
    }

    db.ref("blocked").on("value", snap => {
      const blockedData = snap.val() || {};
      const input = document.getElementById("messageInput");
      if (blockedData[username] && blockedData[username] > Date.now()) {
        input.disabled = true;
        input.placeholder = "‚ùå Kamu diblokir sementara...";
      } else {
        input.disabled = false;
        input.placeholder = "Ketik pesan...";
      }
    });
  </script>
</body>
</html>
